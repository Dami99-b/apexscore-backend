<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ApexScore – AI-Powered Loan Risk Intelligence</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.tailwindcss.com"></script>
<style>
@keyframes slideLeft { from {transform:translateX(0)} to {transform:translateX(-50%)} }
.marquee-content { animation: slideLeft 30s linear infinite }
.fade-in { animation: fadeIn .4s ease-out }
@keyframes fadeIn { from{opacity:0;transform:translateY(20px)} to{opacity:1;transform:none} }
.modal-backdrop { backdrop-filter: blur(8px) }
</style>
</head>

<body class="bg-gradient-to-br from-slate-900 via-gray-900 to-black text-white min-h-screen">

<header class="sticky top-0 z-40 bg-black/50 border-b border-white/10 backdrop-blur">
  <div class="p-4 flex flex-wrap items-center justify-between gap-3">
    <div class="flex items-center gap-3">
      <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center font-black text-xl">A</div>
      <div>
        <h1 class="text-2xl font-black">ApexScore</h1>
        <p class="text-xs text-gray-400">AI Risk Intelligence</p>
      </div>
    </div>

    <div class="flex gap-2 w-full sm:w-auto">
      <div class="relative flex-1 sm:flex-none">
        <input id="searchInput" placeholder="Search email..."
          class="w-full sm:w-64 px-3 py-2 rounded-lg text-black pr-20">
        <button id="searchBtn"
          class="absolute right-1 top-1 px-3 py-1 rounded-md text-sm bg-gradient-to-r from-blue-600 to-purple-600">
          Search
        </button>
      </div>
    </div>
  </div>
</header>

<div class="px-6 py-6 grid grid-cols-2 lg:grid-cols-4 gap-4">
  <div class="card"><div>Total Applicants</div><div id="totalApplicants">-</div></div>
  <div class="card"><div>High Risk</div><div id="highRiskCount">-</div></div>
  <div class="card"><div>Avg Score</div><div id="avgScore">-</div></div>
  <div class="card"><div>Speed</div><div>&lt;500ms</div></div>
</div>

<div class="px-6">
  <div class="border border-white/10 rounded-xl overflow-hidden">
    <div class="p-4 border-b border-white/10 flex justify-between">
      <h2 class="font-bold">Risk Dashboard</h2>
      <span id="tableCount">0</span>
    </div>

    <table class="w-full text-sm">
      <thead class="bg-white/5 text-gray-400">
        <tr>
          <th class="p-3 text-left">Email</th>
          <th class="p-3 text-left">Name</th>
          <th class="p-3 text-left hidden md:table-cell">City</th>
          <th class="p-3 text-left">Score</th>
          <th class="p-3 text-left">Risk</th>
        </tr>
      </thead>
      <tbody id="table">
        <tr><td colspan="5" class="p-6 text-center text-gray-400">Loading applicants…</td></tr>
      </tbody>
    </table>
  </div>
</div>

<div id="detailModal" class="fixed inset-0 hidden bg-black/80 modal-backdrop z-50">
  <div class="min-h-screen flex justify-center items-center p-4">
    <div class="bg-gray-900 rounded-xl max-w-5xl w-full border border-white/10 fade-in">
      <div class="flex justify-between p-4 border-b border-white/10">
        <h2 id="modalTitle" class="text-xl font-bold"></h2>
        <button id="closeModal" class="text-2xl">&times;</button>
      </div>
      <div id="modalContent" class="p-6 space-y-4"></div>
    </div>
  </div>
</div>

<script>
(() => {
const API = "https://apexscore.onrender.com";
let data = [];

const $ = id => document.getElementById(id);

function safe(v, d="—"){ return v ?? d }

function getRiskColor(r){
  return r==="Low"?"text-green-400":r==="Medium"?"text-yellow-400":"text-red-400";
}

function load(){
  fetch(API+"/api/applicants?limit=40")
    .then(r=>r.json())
    .then(j=>{
      data = j.applicants || [];
      render();
      updateStats();
    });
}

function updateStats(){
  $("totalApplicants").textContent = data.length;
  $("highRiskCount").textContent = data.filter(a=>a.risk_level==="High").length;
  $("avgScore").textContent = Math.round(data.reduce((s,a)=>s+(a.apex_score||0),0)/data.length||0);
  $("tableCount").textContent = data.length;
}

function render(){
  const t = $("table"); t.innerHTML="";
  data.forEach(a=>{
    const tr=document.createElement("tr");
    tr.className="border-b border-white/5 hover:bg-white/5 cursor-pointer";
    tr.onclick=()=>showDetail(a);
    tr.innerHTML=`
      <td class="p-3">${safe(a.email)}</td>
      <td class="p-3">${safe(a.name?.full)}</td>
      <td class="p-3 hidden md:table-cell">${safe(a.location?.city)}</td>
      <td class="p-3 ${getRiskColor(a.apex_score>=75?"Low":a.apex_score>=50?"Medium":"High")}">${safe(a.apex_score)}</td>
      <td class="p-3">${safe(a.risk_level)}</td>`;
    t.appendChild(tr);
  });
}

function searchApplicant(){
  const email=$("searchInput").value.trim();
  if(!email)return;
  fetch(API+"/api/search?email="+encodeURIComponent(email))
    .then(r=>r.json())
    .then(showDetail);
}

function showDetail(a){
  $("modalTitle").textContent = safe(a.name?.full);
  $("modalContent").innerHTML = `
    <div class="text-5xl font-black ${getRiskColor(a.risk_level)}">${safe(a.apex_score)}</div>
    <div>Email: ${safe(a.email)}</div>
    <div>Phone: ${safe(a.phone)}</div>
    <div>City: ${safe(a.location?.city)}</div>
    <div>Country: ${safe(a.location?.country)}</div>
    <div>Loans: ${(a.tfd?.loan_history||[]).length}</div>`;
  $("detailModal").classList.remove("hidden");
}

$("closeModal").onclick=()=> $("detailModal").classList.add("hidden");
$("searchBtn").onclick=searchApplicant;
$("searchInput").addEventListener("keypress",e=>e.key==="Enter"&&searchApplicant());

load();
})();
</script>
</body>
</html>  
