<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ApexScore – AI-Powered Loan Risk Intelligence</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.tailwindcss.com"></script>

<style>
@keyframes slideLeft {
  from { transform: translateX(0); }
  to { transform: translateX(-50%); }
}
.marquee-content { animation: slideLeft 30s linear infinite; }
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}
.fade-in { animation: fadeIn .5s ease-out; }
.modal-backdrop { backdrop-filter: blur(8px); }
</style>
</head>

<body class="bg-gradient-to-br from-slate-900 via-gray-900 to-black text-white min-h-screen">

<!-- HEADER (UNCHANGED) -->
<!-- ... YOUR HEADER CODE HERE — NOT MODIFIED ... -->

<!-- TABLE + MODAL UI -->
<!-- ... ALL YOUR UI CODE REMAINS EXACTLY THE SAME ... -->

<script>
const API = "https://apexscore.onrender.com";
let data = [];
let usingMock = false;

/* ---------------- MOCK DATA ---------------- */

function generateHumanEmail(fn, ln) {
  const patterns = [
    `${fn}${ln}`,
    `${fn}${Math.floor(Math.random()*90+10)}${ln}`,
    `${ln}${fn}`,
    `${fn}${ln.slice(0,2)}`,
    `${fn}${ln}${Math.floor(Math.random()*9)}`
  ];
  const domains = ["gmail.com","yahoo.com","outlook.com","icloud.com"];
  return patterns[Math.floor(Math.random()*patterns.length)].toLowerCase()
         + "@" + domains[Math.floor(Math.random()*domains.length)];
}

function generateMockData() {
  const first = ["Michael","David","Blessing","Fatima","Esther","Joseph","Daniel","Grace","Ahmed","Linda"];
  const last = ["Anderson","Brown","Okoye","Hassan","Adeyemi","Johnson","Williams","Garcia"];
  const cities = ["Lagos","New York","London","Berlin","Houston","Ibadan"];

  return Array.from({length:120}).map((_,i)=>{
    const fn = first[Math.floor(Math.random()*first.length)];
    const ln = last[Math.floor(Math.random()*last.length)];
    const score = Math.floor(Math.random()*66)+30;

    return {
      id: "mock-"+i,
      email: generateHumanEmail(fn,ln),
      name:{ full:`${fn} ${ln}` },
      location:{ city:cities[Math.floor(Math.random()*cities.length)] },
      apex_score: score,
      risk_level: score>=75?"Low":score>=50?"Medium":"High"
    };
  });
}

/* ---------------- LOAD DATA ---------------- */

async function load() {
  try {
    const res = await fetch(`${API}/api/applicants?limit=120`);
    const json = await res.json();

    if (json.applicants?.length) {
      data = json.applicants;
      usingMock = false;
    } else throw "Empty";
  } catch {
    data = generateMockData();
    usingMock = true;
  }
  render();
  updateStats();
}

load();

/* rotate mock every 3s */
setInterval(()=>{
  if(usingMock){
    data = generateMockData();
    render();
    updateStats();
  }
},3000);

/* ---------------- SEARCH ---------------- */

document.getElementById("searchBtn").onclick = async ()=>{
  const email = document.getElementById("searchInput").value.trim();
  if(!email) return;

  try{
    const res = await fetch(`${API}/api/search?email=${encodeURIComponent(email)}`);
    const a = await res.json();
    data = [a];
    render();
    updateStats();
    showDetail(a);
  }catch{
    alert("Search failed");
  }
};

/* ---------------- STATS ---------------- */

function updateStats(){
  const total = data.length;
  const high = data.filter(a=>a.risk_level==="High").length;
  const avg = Math.round(data.reduce((s,a)=>s+a.apex_score,0)/total);

  totalApplicants.textContent = total;
  highRiskCount.textContent = high;
  avgScore.textContent = avg;
  tableCount.textContent = total;
}

/* ---------------- RENDER ---------------- */

function getRiskColor(l){
  return l==="Low"?"bg-green-500/20 text-green-400 border-green-500/30":
         l==="Medium"?"bg-yellow-500/20 text-yellow-400 border-yellow-500/30":
         "bg-red-500/20 text-red-400 border-red-500/30";
}
function getScoreColor(s){
  return s>=75?"text-green-400":s>=50?"text-yellow-400":"text-red-400";
}

function render(){
  table.innerHTML="";
  data.forEach(a=>{
    const tr=document.createElement("tr");
    tr.className="border-b border-white/5 hover:bg-white/5 cursor-pointer";
    tr.onclick=()=>showDetail(a);
    tr.innerHTML=`
      <td class="px-6 py-4">${a.email}</td>
      <td class="px-6 py-4 font-medium">${a.name.full}</td>
      <td class="px-6 py-4 hidden md:table-cell text-gray-400">${a.location.city}</td>
      <td class="px-6 py-4 font-bold ${getScoreColor(a.apex_score)}">${a.apex_score}</td>
      <td class="px-6 py-4">
        <span class="px-2 py-1 rounded-full border ${getRiskColor(a.risk_level)}">
          ${a.risk_level}
        </span>
      </td>`;
    table.appendChild(tr);
  });
}
</script>
</body>
</html>
