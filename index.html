<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ApexScore – Risk Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-[#F8FAFC] text-gray-900">

<script>
const API_BASE = "https://apexscore.onrender.com";
let applicants = [];

async function loadStats() {
  const r = await fetch(`${API_BASE}/api/stats`);
  const s = await r.json();
  totalApplicants.innerText = s.total_applicants;
  activeDefaults.innerText = s.active_defaults;
  highRiskRatio.innerText = s.high_risk_percentage;
}

async function loadApplicants() {
  const r = await fetch(`${API_BASE}/api/applicants`);
  const d = await r.json();
  applicants = d.applicants || [];
  render();
}

async function searchEmail() {
  const q = searchInput.value.trim();
  if (!q) return;
  const r = await fetch(`${API_BASE}/api/search?email=${encodeURIComponent(q)}`);
  const d = await r.json();
  applicants.unshift(d);
  render();
}

function render() {
  tableBody.innerHTML = "";
  applicants.forEach(a => {
    tableBody.innerHTML += `
      <tr class="hover:bg-gray-50">
        <td class="px-6 py-3 font-semibold">${a.name.full}</td>
        <td class="px-6 py-3">${a.occupation}</td>
        <td class="px-6 py-3">${a.apex_score}</td>
        <td class="px-6 py-3">${a.risk_level}</td>
      </tr>
    `;
  });
}

window.onload = async () => {
  await loadStats();
  await loadApplicants();
  setInterval(loadApplicants, 3000);
};
</script>

<div class="max-w-7xl mx-auto">

<nav class="bg-white border-b px-6 py-4 flex justify-between">
  <h1 class="font-black text-xl">ApexScore</h1>
  <div class="flex gap-2">
    <input id="searchInput" placeholder="Search email…" class="border px-3 py-1 rounded"/>
    <button onclick="searchEmail()" class="bg-red-600 text-white px-4 rounded">Search</button>
  </div>
</nav>

<div class="grid grid-cols-4 gap-4 p-6">
  <div class="bg-white p-4 rounded">Applicants: <b id="totalApplicants"></b></div>
  <div class="bg-white p-4 rounded">Defaults: <b id="activeDefaults"></b></div>
  <div class="bg-white p-4 rounded">High Risk %: <b id="highRiskRatio"></b></div>
  <div class="bg-white p-4 rounded">Model: 98.2%</div>
</div>

<div class="p-6">
<table class="w-full bg-white rounded">
<thead class="bg-gray-100 text-xs uppercase">
<tr>
<th class="px-6 py-3">Applicant</th>
<th class="px-6 py-3">Occupation</th>
<th class="px-6 py-3">Score</th>
<th class="px-6 py-3">Risk</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>
</div>

</div>
</body>
</html>
