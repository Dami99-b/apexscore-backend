<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ApexScore AI – Global Credit Intelligence</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- React -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

  <style>
    body {
      margin: 0;
      font-family: Inter, system-ui, Arial;
      background: #f5f7fb;
      color: #111;
    }
    header {
      background: #111827;
      color: white;
      padding: 16px 24px;
    }
    input {
      padding: 10px;
      width: 100%;
      font-size: 14px;
    }
    button {
      padding: 10px 16px;
      background: #c1121f;
      color: white;
      border: none;
      cursor: pointer;
    }
    .container {
      padding: 24px;
      max-width: 1200px;
      margin: auto;
    }
    .card {
      background: white;
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }
    th, td {
      padding: 8px;
      border-bottom: 1px solid #eee;
      text-align: left;
    }
    .badge {
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: bold;
    }
    .low { background: #dcfce7; color: #166534; }
    .medium { background: #fef3c7; color: #92400e; }
    .high { background: #fee2e2; color: #991b1b; }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 16px;
    }
    small { color: #666; }
  </style>
</head>

<body>
<header>
  <h2>ApexScore AI</h2>
  <small>Unified Global Loan & Risk Intelligence</small>
</header>

<div id="root"></div>

<script type="text/babel">
const API = "https://apexscore.onrender.com";

function App() {
  const [email, setEmail] = React.useState("");
  const [profile, setProfile] = React.useState(null);
  const [feed, setFeed] = React.useState([]);

  // endless feed (auto-generate)
  React.useEffect(() => {
    const interval = setInterval(async () => {
      const randomEmail =
        "user" + Math.floor(Math.random() * 100000) + "@mail.com";

      const res = await fetch(\`\${API}/api/search?email=\${randomEmail}\`);
      const data = await res.json();

      setFeed(prev => [data, ...prev].slice(0, 50));
    }, 3000);

    return () => clearInterval(interval);
  }, []);

  const search = async () => {
    if (!email) return;
    const res = await fetch(\`\${API}/api/search?email=\${email}\`);
    const data = await res.json();
    setProfile(data);
  };

  return (
    <div className="container">
      <div className="card">
        <h3>Search by Email</h3>
        <input
          placeholder="e.g. kreuger453@gmail.com"
          value={email}
          onChange={e => setEmail(e.target.value)}
        />
        <br /><br />
        <button onClick={search}>Search</button>
      </div>

      {profile && (
        <div className="card">
          <h3>{profile.legal_name?.full}</h3>
          <span className={"badge " + profile.risk_level.toLowerCase()}>
            ApexScore {profile.apex_score} – {profile.risk_level}
          </span>

          <div className="grid" style={{marginTop: 16}}>
            <div>
              <strong>Contact</strong>
              <p>{profile.email}</p>
              <p>{profile.phone}</p>
              <p>{profile.occupation}</p>
            </div>

            <div>
              <strong>Location</strong>
              <p>{profile.location.address}</p>
              <p>{profile.location.city}, {profile.location.country}</p>
              <iframe
                width="100%"
                height="150"
                style={{border:0}}
                loading="lazy"
                src={`https://www.google.com/maps?q=${profile.location.coordinates.lat},${profile.location.coordinates.lng}&output=embed`}
              />
            </div>

            <div>
              <strong>Outstanding Debt</strong>
              <p>{profile.tfd.currency} {profile.tfd.outstanding_debt.toLocaleString()}</p>
            </div>
          </div>

          <h4>Loan History</h4>
          <table>
            <thead>
              <tr><th>Institution</th><th>Amount</th><th>Date</th></tr>
            </thead>
            <tbody>
              {profile.tfd.loan_history.map((l,i)=>(
                <tr key={i}>
                  <td>{l.institution}</td>
                  <td>{profile.tfd.currency} {l.amount.toLocaleString()}</td>
                  <td>{l.date}</td>
                </tr>
              ))}
            </tbody>
          </table>

          <h4>Repayment History</h4>
          <table>
            <thead>
              <tr><th>Month</th><th>Status</th><th>Amount</th><th>Days Late</th></tr>
            </thead>
            <tbody>
              {profile.tfd.repayment_history.map((r,i)=>(
                <tr key={i}>
                  <td>{r.date}</td>
                  <td>{r.status}</td>
                  <td>{r.amount}</td>
                  <td>{r.days_late || "-"}</td>
                </tr>
              ))}
            </tbody>
          </table>

          <h4>Behavioral Stability Index</h4>
          {Object.entries(profile.bsi).map(([k,v])=>(
            <p key={k}>{k.replaceAll("_"," ")}: {v}</p>
          ))}
        </div>
      )}

      <div className="card">
        <h3>Live Global Feed (Auto-generated)</h3>
        {feed.map((f,i)=>(
          <p key={i}>
            {f.legal_name?.full} — {f.email} — Score {f.apex_score}
          </p>
        ))}
      </div>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>
</body>
</html>
